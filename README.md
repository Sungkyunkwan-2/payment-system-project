# ğŸ’³ CommerceHub - í†µí•© ì»¤ë¨¸ìŠ¤ ê²°ì œ í”Œë«í¼

> PortOne V2 APIë¥¼ í™œìš©í•œ ì¼ë°˜ ê²°ì œ Â· êµ¬ë… ê²°ì œ Â· í™˜ë¶ˆ Â· í¬ì¸íŠ¸ ì‹œìŠ¤í…œì„ ì§€ì›í•˜ëŠ” Spring Boot ë°±ì—”ë“œ í”„ë¡œì íŠ¸

[![Build Status](https://img.shields.io/badge/build-passing-brightgreen)]()
[![Java](https://img.shields.io/badge/Java-17-007396?logo=java&logoColor=white)]()
[![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.x-6DB33F?logo=springboot&logoColor=white)]()
[![License](https://img.shields.io/badge/license-MIT-blue)]()

<br/>

## ğŸ“‹ ëª©ì°¨

- [í”„ë¡œì íŠ¸ ì†Œê°œ](#-í”„ë¡œì íŠ¸-ì†Œê°œ)
- [ì£¼ìš” ê¸°ëŠ¥](#-ì£¼ìš”-ê¸°ëŠ¥)
- [ê¸°ìˆ  ìŠ¤íƒ](#-ê¸°ìˆ -ìŠ¤íƒ)
- [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#-ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
- [ERD ì„¤ê³„](#-erd-ì„¤ê³„)
- [ê²°ì œ í”Œë¡œìš°](#-ê²°ì œ-í”Œë¡œìš°)
- [CI/CD íŒŒì´í”„ë¼ì¸](#-cicd-íŒŒì´í”„ë¼ì¸)
- [API ë¬¸ì„œ](#-api-ë¬¸ì„œ)
- [ì‹¤í–‰ ë°©ë²•](#-ì‹¤í–‰-ë°©ë²•)
- [í”„ë¡œì íŠ¸ êµ¬ì¡°](#-í”„ë¡œì íŠ¸-êµ¬ì¡°)
- [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#-íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)
- [ì„±ëŠ¥ ìµœì í™”](#-ì„±ëŠ¥-ìµœì í™”)
- [í–¥í›„ ê°œì„  ê³„íš](#-í–¥í›„-ê°œì„ -ê³„íš)
- [ë°°ìš´ ì ](#-ë°°ìš´-ì )

<br/>

## ğŸ¯ í”„ë¡œì íŠ¸ ì†Œê°œ

### í”„ë¡œì íŠ¸ ê°œìš”

**CommerceHub**ëŠ” PortOne V2 APIë¥¼ ì—°ë™í•˜ì—¬ ì¼ë°˜ ê²°ì œ, êµ¬ë… ê²°ì œ, í™˜ë¶ˆ ì²˜ë¦¬ë¥¼ ì œê³µí•˜ëŠ” í†µí•© ì»¤ë¨¸ìŠ¤ ë°±ì—”ë“œ í”Œë«í¼ì…ë‹ˆë‹¤.
JWT ê¸°ë°˜ ì¸ì¦, í¬ì¸íŠ¸ ì‹œìŠ¤í…œ, ë©¤ë²„ì‹­ ë“±ê¸‰, ì›¹í›… ì„œëª… ê²€ì¦ ë“± ì‹¤ì œ ì„œë¹„ìŠ¤ ìˆ˜ì¤€ì˜ ê²°ì œ í”Œë¡œìš°ë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

### ê°œë°œ ê¸°ê°„
- **ì „ì²´ ê¸°ê°„**: [2/4 ~ 2/20]
- **ê¸°íš ë° ì„¤ê³„**: [2/4 ~ 2/5] ë„ë©”ì¸ ì„¤ê³„, ERD ì‘ì„±, API ëª…ì„¸ ì •ì˜
- **í•µì‹¬ ê¸°ëŠ¥ ê°œë°œ**: [2/6 ~ 2/11] ê²°ì œÂ·í™˜ë¶ˆÂ·êµ¬ë… ë¡œì§, PortOne ì—°ë™, í¬ì¸íŠ¸Â·ë©¤ë²„ì‹­ ì‹œìŠ¤í…œ
- **CI/CD êµ¬ì¶•**: [2/12 ~ 2/13] GitHub Actions, AWS ë°°í¬ ìë™í™”
- **í…ŒìŠ¤íŠ¸ ë° ë°°í¬**: [2/14 ~ 2/20] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸, í†µí•© í…ŒìŠ¤íŠ¸, ìš´ì˜ í™˜ê²½ ë°°í¬

### ê°œë°œ ì¸ì›

5ëª…(ê³½í˜„ë¯¼, ê¹€ëŒ€í›ˆ, ê¹€ì„¸í˜„, ì´í˜„ì„, ìœ ì§€í˜„)

### í”„ë¡œì íŠ¸ ëª©í‘œ
- âœ… PortOne V2 APIë¥¼ í™œìš©í•œ ì‹¤ê²°ì œ í™˜ê²½ êµ¬í˜„
- âœ… JWT ê¸°ë°˜ Stateless ì¸ì¦ ë° Refresh Token ë¡œí…Œì´ì…˜
- âœ… í¬ì¸íŠ¸ ì „ì•¡/ë¶€ë¶„ ê²°ì œ, ì ë¦½, ë§Œë£Œ ì‹œìŠ¤í…œ êµ¬í˜„
- âœ… ì›¹í›… ì„œëª… ê²€ì¦ì„ í†µí•œ ì•ˆì „í•œ ê²°ì œ ì´ë²¤íŠ¸ ì²˜ë¦¬
- âœ… êµ¬ë… ì •ê¸° ê²°ì œ ë° ë©¤ë²„ì‹­ ë“±ê¸‰ ìë™ ê°±ì‹ 

<br/>

## âœ¨ ì£¼ìš” ê¸°ëŠ¥

### 1. íšŒì› ì¸ì¦ (Auth)

JWT Access Token + Refresh Token ì´ì¤‘ ì¸ì¦ ë°©ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
- íšŒì›ê°€ì… / ë¡œê·¸ì¸ / ë¡œê·¸ì•„ì›ƒ
- Refresh Tokenì€ HttpOnly ì¿ í‚¤ë¡œ ê´€ë¦¬, Access Tokenì€ Authorization í—¤ë”ë¡œ ì „ë‹¬
- í† í° ì¬ë°œê¸‰ (Sliding Session ë°©ì‹)

### 2. ìƒí’ˆ ë° ì£¼ë¬¸ (Product / Order)

- ìƒí’ˆ ëª©ë¡ ì¡°íšŒ ë° ë‹¨ê±´ ì¡°íšŒ
- ì£¼ë¬¸ ìƒì„± ì‹œ ìƒí’ˆ ì¬ê³  ìë™ ì°¨ê° ë° í’ˆì ˆ ìƒíƒœ ì „í™˜
- ì£¼ë¬¸ ë²ˆí˜¸ ìë™ ìƒì„± (`@PrePersist` ê¸°ë°˜ íƒ€ì„ìŠ¤íƒ¬í”„)

### 3. ì¼ë°˜ ê²°ì œ (Payment) â­

- PortOne V2 APIë¥¼ ì—°ë™í•œ ê²°ì œ ì‹œì‘ ë° í™•ì¸
- í¬ì¸íŠ¸ ì „ì•¡ ê²°ì œ (PG í˜¸ì¶œ ì—†ì´ ì¦‰ì‹œ SUCCESS)
- í¬ì¸íŠ¸ ë¶€ë¶„ ê²°ì œ (ì”ì—¬ ê¸ˆì•¡ë§Œ PG ê²°ì œ)
- ê²°ì œ ì‹¤íŒ¨ ì‹œ ë³´ìƒ íŠ¸ëœì­ì…˜(í™˜ë¶ˆ) ìë™ ìˆ˜í–‰
- ì¤‘ë³µ ê²°ì œ í™•ì¸ ë°©ì§€ (`DuplicatePaymentConfirmException`)

### 4. **í™˜ë¶ˆ ì²˜ë¦¬ (Refund)** â­

- PortOne í™˜ë¶ˆ API ì—°ë™
- Append-Only íŒ¨í„´ìœ¼ë¡œ í™˜ë¶ˆ ì´ë ¥ ì˜êµ¬ ë³´ì¡´
- í™˜ë¶ˆ ìš”ì²­ â†’ ì„±ê³µ/ì‹¤íŒ¨ ìƒíƒœ ë¶„ë¦¬ ì €ì¥

### 5. êµ¬ë… ë° ì •ê¸° ë¹Œë§ (Subscription / Billing)

- êµ¬ë… ì‹ ì²­ / ì¡°íšŒ / í•´ì§€
- êµ¬ë… ì¦‰ì‹œ ê²°ì œ (ë¹Œë§í‚¤ ê¸°ë°˜)
- ì²­êµ¬ ë‚´ì—­ ì¡°íšŒ

### 6. ì›¹í›… ì²˜ë¦¬ (Webhook)

- PortOne ì›¹í›… ìˆ˜ì‹  ë° HMAC ì„œëª… ê²€ì¦
- ì„œëª… ë¶ˆì¼ì¹˜ ì‹œ 401 ì‘ë‹µ, ì²˜ë¦¬ ì‹¤íŒ¨ ì‹œ 500 ì‘ë‹µ
- ì›¹í›… ì´ë²¤íŠ¸ DB ì €ì¥ (ë©±ë“±ì„± ë³´ì¥)

### 7. í¬ì¸íŠ¸ ì‹œìŠ¤í…œ (Point)

- ê²°ì œ ì™„ë£Œ ì‹œ í¬ì¸íŠ¸ ìë™ ì ë¦½
- ê²°ì œ ì‹œ í¬ì¸íŠ¸ ì‚¬ìš© (ì „ì•¡ / ë¶€ë¶„)
- í¬ì¸íŠ¸ ë§Œë£Œ ì²˜ë¦¬

### 8. ë©¤ë²„ì‹­ ë“±ê¸‰ (Membership)

- ì´ ëˆ„ì  ê±°ë˜ì•¡ ê¸°ë°˜ ë©¤ë²„ì‹­ ë“±ê¸‰ ì‚°ì •
- Spring `@Scheduled` ìŠ¤ì¼€ì¤„ëŸ¬ë¡œ ë§¤ì¼ 00:00 ì „ì²´ ì‚¬ìš©ì ë“±ê¸‰ ê°±ì‹ 
- ì´ë²¤íŠ¸ ê¸°ë°˜(`ApplicationEventPublisher`) ë¹„ë™ê¸° ì´ ê±°ë˜ì•¡ ì—…ë°ì´íŠ¸

<br/>

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ

### Backend
![Java](https://img.shields.io/badge/Java-17-007396?logo=java&logoColor=white)
![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.x-6DB33F?logo=springboot&logoColor=white)

**ìƒì„¸ ê¸°ìˆ **
- **Framework**: Spring Boot 3.x, Spring MVC
- **ORM**: Spring Data JPA, Hibernate
- **Security**: Spring Security, JWT (JJWT), BCrypt
- **Validation**: Jakarta Validation (Bean Validation)
- **Template Engine**: Thymeleaf
- **HTTP Client**: Spring RestClient (PortOne API í˜¸ì¶œ)
- **Scheduler**: Spring `@Scheduled`
- **Event**: Spring `ApplicationEventPublisher`
- **Test**: JUnit 5, Mockito

### Database
![MySQL](https://img.shields.io/badge/MySQL-8.0-4479A1?logo=mysql&logoColor=white)

- **Primary DB**: MySQL 8.0

### Infrastructure
![Docker](https://img.shields.io/badge/Docker-2496ED?logo=docker&logoColor=white)
![AWS](https://img.shields.io/badge/AWS-232F3E?logo=amazonaws&logoColor=white)

- **Container**: Docker, Docker Compose
- **Cloud**: AWS (EC2, Parameter Store)
- **CI/CD**: GitHub Actions
- **Config**: AWS Parameter Store (í™˜ê²½ ë³€ìˆ˜ ì¤‘ì•™ ê´€ë¦¬)

### Tools
![Git](https://img.shields.io/badge/Git-F05032?logo=git&logoColor=white)
![Gradle](https://img.shields.io/badge/Gradle-02303A?logo=gradle&logoColor=white)

- **Build**: Gradle
- **PG ì—°ë™**: PortOne V2 API

<br/>

## ğŸ— ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
[Client / Browser]
        â”‚
        â–¼
[Spring Security Filter Chain]
  â”œâ”€ JWT Authentication Filter
  â”œâ”€ CORS Filter
  â””â”€ Exception Handler

        â”‚
        â–¼
[Controller Layer]
  â”œâ”€ AuthController         â† ì¸ì¦/ì¸ê°€
  â”œâ”€ ProductController      â† ìƒí’ˆ ì¡°íšŒ
  â”œâ”€ OrderController        â† ì£¼ë¬¸ ìƒì„±
  â”œâ”€ PaymentController      â† ê²°ì œ ì‹œì‘/í™•ì¸
  â”œâ”€ RefundController       â† í™˜ë¶ˆ ìš”ì²­
  â”œâ”€ SubscriptionController â† êµ¬ë… ê´€ë¦¬
  â”œâ”€ BillingController      â† ë¹Œë§ ê´€ë¦¬
  â””â”€ WebhookEventController â† PortOne ì›¹í›… ìˆ˜ì‹ 

        â”‚
        â–¼
[Service Layer]
  â”œâ”€ PaymentService   â”€â”€ RestClient â”€â”€â–¶ [PortOne V2 API]
  â”œâ”€ RefundService    â”€â”€ RestClient â”€â”€â–¶ [PortOne V2 API]
  â”œâ”€ PointService
  â”œâ”€ MembershipService
  â””â”€ MembershipScheduler (@Scheduled, ë§¤ì¼ 00:00)

        â”‚
        â–¼
[Repository Layer (Spring Data JPA)]
        â”‚
        â–¼
[MySQL 8.0]
```

### ì£¼ìš” ì„¤ê³„ ê²°ì •ì‚¬í•­

#### 1. Append-Only íŒ¨í„´ (ê²°ì œ Â· í™˜ë¶ˆ)

ê²°ì œ(Payment)ì™€ í™˜ë¶ˆ(Refund) ì—”í‹°í‹°ëŠ” ìƒíƒœë¥¼ ì§ì ‘ ë³€ê²½í•˜ì§€ ì•Šê³  ìƒˆë¡œìš´ rowë¥¼ append ë°©ì‹ìœ¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤.
ê²°ì œ ì´ë ¥ì˜ ë¬´ê²°ì„±ì„ ë³´ì¥í•˜ê³  ê°ì‚¬ ì¶”ì (audit trail)ì´ ìš©ì´í•©ë‹ˆë‹¤.

#### 2. ì´ë²¤íŠ¸ ê¸°ë°˜ ë©¤ë²„ì‹­ ê°±ì‹ 

ê²°ì œ ì„±ê³µ ì‹œ `TotalSpendChangedEvent`ë¥¼ ë°œí–‰í•˜ì—¬ ë©¤ë²„ì‹­ ë“±ê¸‰ ì—…ë°ì´íŠ¸ë¥¼ ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
ë„ë©”ì¸ ê°„ ê²°í•©ë„ë¥¼ ë‚®ì¶”ê³  í™•ì¥ì„±ì„ ë†’ì˜€ìŠµë‹ˆë‹¤.

#### 3. ì›¹í›… ì„œëª… ê²€ì¦

PortOne ì›¹í›… ìˆ˜ì‹  ì‹œ `PortOneWebhookVerifier`ë¡œ HMAC ì„œëª…ì„ ê²€ì¦í•˜ì—¬, ìœ„ì¡°ëœ ì›¹í›… ìš”ì²­ì„ ì‚¬ì „ì— ì°¨ë‹¨í•©ë‹ˆë‹¤.

<br/>

## ğŸ“Š ERD ì„¤ê³„

### ì „ì²´ ERD

![ERD.png](img/ERD.png)

### ì£¼ìš” í…Œì´ë¸” ì„¤ëª…

#### 1. **users**
```sql
CREATE TABLE users (
    id             BIGINT AUTO_INCREMENT PRIMARY KEY,
    role           VARCHAR(20)    NOT NULL,  -- USER, ADMIN
    username       VARCHAR(100)   NOT NULL,
    phone          VARCHAR(20)    NOT NULL,
    email          VARCHAR(255)   NOT NULL UNIQUE,
    password       VARCHAR(255)   NOT NULL,
    point_balance  DECIMAL(19,2)  NOT NULL DEFAULT 0,
    total_spend    DECIMAL(19,2)  NOT NULL DEFAULT 0,
    deleted_at     DATETIME,
    created_at     DATETIME       NOT NULL,
    updated_at     DATETIME       NOT NULL
);
```

#### 2. **orders**
```sql
CREATE TABLE orders (
    id           BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id      BIGINT         NOT NULL,
    order_number BIGINT         NOT NULL UNIQUE,  -- ìë™ ìƒì„±
    total_price  DECIMAL(19,2)  NOT NULL,
    used_point   DECIMAL(19,2),
    status       VARCHAR(30)    NOT NULL,  -- PAYMENT_PENDING, ORDER_COMPLETED, ORDER_CANCELED
    deleted_at   DATETIME,
    created_at   DATETIME       NOT NULL,
    updated_at   DATETIME       NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

#### 3. **order_products**
```sql
CREATE TABLE order_products (
    id           BIGINT AUTO_INCREMENT PRIMARY KEY,
    order_id     BIGINT         NOT NULL,
    product_id   BIGINT         NOT NULL,
    product_name VARCHAR(255)   NOT NULL,
    price        DECIMAL(19,2)  NOT NULL,
    currency     VARCHAR(10)    NOT NULL,
    quantity     BIGINT         NOT NULL,
    deleted_at   DATETIME,
    created_at   DATETIME       NOT NULL,
    updated_at   DATETIME       NOT NULL,
    FOREIGN KEY (order_id) REFERENCES orders(id)
);
```

#### 4. **payments** â­ (í•µì‹¬ í…Œì´ë¸”)
```sql
CREATE TABLE payments (
    id          BIGINT AUTO_INCREMENT PRIMARY KEY,
    order_id    BIGINT         NOT NULL,
    payment_id  VARCHAR(100),  -- PortOne ê²°ì œ ID (PAY_xxxxxxxx)
    status      VARCHAR(20)    NOT NULL,  -- PENDING, SUCCESS, FAILURE, REFUND
    price       DECIMAL(19,2)  NOT NULL,
    paid_at     DATETIME,
    refunded_at DATETIME,
    deleted_at  DATETIME,
    created_at  DATETIME       NOT NULL,
    updated_at  DATETIME       NOT NULL,
    FOREIGN KEY (order_id) REFERENCES orders(id)
);
```

#### 5. **refunds**
```sql
CREATE TABLE refunds (
    id          BIGINT AUTO_INCREMENT PRIMARY KEY,
    payment_id  BIGINT         NOT NULL,
    amount      DECIMAL(19,2)  NOT NULL,
    reason      VARCHAR(500)   NOT NULL,
    status      VARCHAR(20)    NOT NULL,  -- REQUEST, SUCCESS, FAILURE
    refunded_at DATETIME,
    deleted_at  DATETIME,
    created_at  DATETIME       NOT NULL,
    updated_at  DATETIME       NOT NULL,
    FOREIGN KEY (payment_id) REFERENCES payments(id)
);
```

### ERD ì„¤ê³„ í¬ì¸íŠ¸

#### ì •ê·œí™”
- ì£¼ë¬¸(orders)ê³¼ ì£¼ë¬¸ìƒí’ˆ(order_products)ì„ ë¶„ë¦¬í•˜ì—¬ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ ì •ê·œí™”
- ê²°ì œ(payments)ì™€ í™˜ë¶ˆ(refunds)ì„ ë³„ë„ í…Œì´ë¸”ë¡œ ê´€ë¦¬í•˜ì—¬ ì´ë ¥ ì¶”ì 

#### ì¸ë±ìŠ¤ ì „ëµ
- `users.email` - UNIQUE ì¸ë±ìŠ¤ (ë¡œê·¸ì¸ ì¡°íšŒ)
- `orders.order_number` - UNIQUE ì¸ë±ìŠ¤ (ì£¼ë¬¸ ë²ˆí˜¸ ì¤‘ë³µ ë°©ì§€)
- `payments.payment_id` - ë³µí•© ì¡°íšŒ ìµœì í™” (`findFirstByPaymentIdOrderByIdDesc`)

#### ì œì•½ì¡°ê±´
- Soft Delete íŒ¨í„´ ì ìš© (`deleted_at` ì»¬ëŸ¼)
- Append-Only íŒ¨í„´ìœ¼ë¡œ ê²°ì œ/í™˜ë¶ˆ ì´ë ¥ ë³´ì¡´

<br/>

## ğŸ”„ ê²°ì œ í”Œë¡œìš°

### ì „ì²´ ê²°ì œ í”„ë¡œì„¸ìŠ¤

![á„‰á…¥á†¼á„€á…²á†«á„€á…ªá†«_á„€á…§á†¯á„Œá…¦ á„‰á…µá„‰á…³á„á…¦á†·](https://github.com/user-attachments/assets/eb017005-3e36-4922-8507-473fe6d251c2)

### í™˜ë¶ˆ í”„ë¡œì„¸ìŠ¤

![á„‰á…¥á†¼á„€á…²á†«á„€á…ªá†«_í™˜ë¶ˆ á„‰á…µá„‰á…³á„á…¦á†·](https://github.com/user-attachments/assets/a7f263b7-5de3-4d66-812d-360a25c78377)

### ì£¼ìš” êµ¬í˜„ ì‚¬í•­

#### 1. ê²°ì œ ìš”ì²­ API
```java
// PaymentController
@PostMapping("/payments")
public ResponseEntity<ApiResponse<StartPaymentResponse>> startPayment(
        @Valid @RequestBody StartPaymentRequest request) {
    return ResponseEntity.status(HttpStatus.CREATED).body(
            ApiResponse.success(HttpStatus.CREATED, "ê²°ì œê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤", paymentService.start(request)));
}
```

#### 2. í¬ì¸íŠ¸ ê²°ì œ ì²˜ë¦¬
```java
// PaymentService - ì „ì•¡ í¬ì¸íŠ¸ ê²°ì œ ì‹œ PortOne í˜¸ì¶œ ì—†ì´ ì¦‰ì‹œ SUCCESS
if (actualPaymentAmount.compareTo(BigDecimal.ZERO) == 0) {
    return handleFullPointPayment(savedPayment, user, order);
}
// í¬ì¸íŠ¸ ì‚¬ìš© í›„ 1000ì› ë¯¸ë§Œ ê²°ì œ ë°©ì§€
if (actualPaymentAmount.compareTo(BigDecimal.valueOf(1000)) < 0) {
    throw new MinimumPaymentAmountException("ê²°ì œ ê¸ˆì•¡ì€ 1000ì› ë¯¸ë§Œì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
}
```

#### 3. ì›¹í›… ì„œëª… ê²€ì¦
```java
// PortOneWebhookVerifier
boolean verified = verifier.verify(rawBody, webhookId, webhookTimestamp, webhookSignature);
if (!verified) {
    return ResponseEntity.status(HttpStatus.UNAUTHORIZED).build();
}
```

#### 4. ë³´ìƒ íŠ¸ëœì­ì…˜ (ê²°ì œ ì‹¤íŒ¨ ì‹œ ìë™ í™˜ë¶ˆ)
```java
// PaymentService.confirm()
} catch (Exception e) {
    refundService.requestRefund(
            payment.getPaymentId(),
            payment.getOrder().getUser().getEmail(),
            new RefundCreateRequest());
    throw new PaymentCompensationException("ê²°ì œ ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ë‚´ë¶€ ì˜¤ë¥˜ë¡œ ì¸í•´ ê²°ì œ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.");
}
```

#### 5. Append-Only í™˜ë¶ˆ ì²˜ë¦¬
```java
// Refund Entity - ìƒíƒœ ë³€ê²½ ëŒ€ì‹  ìƒˆ row append
public Refund success(LocalDateTime refundedAt) {
    return new Refund(this.payment, this.amount, this.reason, RefundStatus.SUCCESS, refundedAt);
}
public Refund failure() {
    return new Refund(this.payment, this.amount, this.reason, RefundStatus.FAILURE, null);
}
```

### ê²°ì œ ìƒíƒœ ê´€ë¦¬

| ìƒíƒœ | ì„¤ëª… | ë‹¤ìŒ ê°€ëŠ¥í•œ ìƒíƒœ |
|------|------|------------------|
| `PENDING` | ê²°ì œ ì‹œì‘ (PG ê²°ì œì°½ í˜¸ì¶œ ì „) | `SUCCESS`, `FAILURE` |
| `SUCCESS` | ê²°ì œ ì„±ê³µ | `REFUND` |
| `FAILURE` | ê²°ì œ ì‹¤íŒ¨ | - |
| `REFUND` | í™˜ë¶ˆ ì™„ë£Œ | - |

### ì£¼ë¬¸ ìƒíƒœ ê´€ë¦¬

| ìƒíƒœ | ì„¤ëª… | ë‹¤ìŒ ê°€ëŠ¥í•œ ìƒíƒœ |
|------|------|------------------|
| `PAYMENT_PENDING` | ê²°ì œ ëŒ€ê¸° ì¤‘ | `ORDER_COMPLETED`, `ORDER_CANCELED` |
| `ORDER_COMPLETED` | ì£¼ë¬¸ ì™„ë£Œ | `ORDER_CANCELED` |
| `ORDER_CANCELED` | ì£¼ë¬¸ ì·¨ì†Œ(í™˜ë¶ˆ) | - |

<br/>

## ğŸš€ CI/CD íŒŒì´í”„ë¼ì¸

### GitHub Actions Workflow

```yaml
name: CI/CD Pipeline

on:
  push:
    branches: [ main, dev ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'
      - name: Build with Gradle
        run: ./gradlew build
      - name: Run Tests
        run: ./gradlew test

  deploy:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to AWS EC2
        # AWS Parameter Storeì—ì„œ í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ í›„ ë°°í¬
```

### ë°°í¬ í™˜ê²½

#### ê°œë°œ í™˜ê²½ (dev branch)
- ë¡œì»¬ Docker Compose ê¸°ë°˜ ê°œë°œ í™˜ê²½
- `application-local.yml` í”„ë¡œíŒŒì¼ ì‚¬ìš©

#### ìš´ì˜ í™˜ê²½ (main branch)
- AWS EC2 ì¸ìŠ¤í„´ìŠ¤ ë°°í¬
- AWS Parameter Storeì—ì„œ ë¯¼ê° ì •ë³´ (DB ì ‘ì†ì •ë³´, JWT Secret, PortOne API Key) ìë™ ë¡œë“œ
- `application-prod.yml` í”„ë¡œíŒŒì¼ ì‚¬ìš©

### ëª¨ë‹ˆí„°ë§

#### Application Metrics
- Spring Boot Actuator (`/actuator/**`) í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸ ì œê³µ

#### Logging
- SLF4J + Logback ê¸°ë°˜ êµ¬ì¡°í™” ë¡œê¹…
- ì›¹í›… ì²˜ë¦¬ ì´ë²¤íŠ¸ ì „ êµ¬ê°„ ë¡œê·¸ ê¸°ë¡ (ìˆ˜ì‹  â†’ ì„œëª…ê²€ì¦ â†’ ì²˜ë¦¬ â†’ ì™„ë£Œ)

<br/>

## ğŸ“¡ API ë¬¸ì„œ

### Base URL
```
Production: https://jihyeon1346.xyz
Development: http://localhost:8080
```

### ì¸ì¦
```http
Authorization: Bearer {JWT_ACCESS_TOKEN}
```

### ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸

#### 1. íšŒì›ê°€ì…
```http
POST /api/auth/register
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123",
  "username": "í™ê¸¸ë™",
  "phone": "010-1234-5678"
}

Response 200 OK
{
  "status": 201,
  "message": "íšŒì›ê°€ì…ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤.",
  "data": { "id": 1, "email": "user@example.com" }
}
```

#### 2. ë¡œê·¸ì¸
```http
POST /api/auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123"
}

Response 200 OK
Header: Authorization: Bearer {accessToken}
Set-Cookie: refreshToken={refreshToken}; HttpOnly; Path=/
```

#### 3. ì£¼ë¬¸ ìƒì„±
```http
POST /orders
Authorization: Bearer {accessToken}
Content-Type: application/json

{
  "items": [
    { "productId": 1, "quantity": 2 }
  ]
}

Response 200 OK
{
  "status": 201,
  "message": "ì£¼ë¬¸ ìƒì„±ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤.",
  "data": { "orderId": "...", "totalPrice": 20000 }
}
```

#### 4. ê²°ì œ ì‹œì‘
```http
POST /payments
Content-Type: application/json

{
  "orderId": "...",
  "totalAmount": 20000,
  "pointsToUse": 1000
}

Response 201 Created
{
  "status": 201,
  "message": "ê²°ì œê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤",
  "data": {
    "paymentId": "PAY_17xxxxxxxx",
    "status": "PENDING",
    "createdAt": "2025-01-01T00:00:00"
  }
}
```

#### 5. ê²°ì œ í™•ì¸
```http
GET /payments/{paymentId}

Response 200 OK
{
  "status": 200,
  "message": "ì„±ê³µì ìœ¼ë¡œ ê²°ì œë˜ì—ˆìŠµë‹ˆë‹¤",
  "data": {
    "orderNumber": 1202501010000000,
    "status": "SUCCESS"
  }
}
```

#### 6. í™˜ë¶ˆ ìš”ì²­
```http
POST /refunds/{paymentId}
Authorization: Bearer {accessToken}
Content-Type: application/json

{
  "reason": "ë‹¨ìˆœ ë³€ì‹¬"
}

Response 200 OK
{
  "status": 200,
  "message": "ìš”ì²­ ì ‘ìˆ˜",
  "data": { "refundId": 1, "status": "REQUEST" }
}
```

#### 7. êµ¬ë… ì‹ ì²­
```http
POST /subscriptions
Authorization: Bearer {accessToken}
Content-Type: application/json

{
  "planId": "...",
  "paymentMethodId": "..."
}
```

### ì—ëŸ¬ ì‘ë‹µ í˜•ì‹
```json
{
  "timestamp": "2025-01-01T00:00:00",
  "status": "400",
  "error": "BAD_REQUEST",
  "message": "ì‚¬ìš© í¬ì¸íŠ¸ê°€ ì£¼ë¬¸ ê¸ˆì•¡ì„ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
  "path": "/payments"
}
```

<br/>

## ğŸƒ ì‹¤í–‰ ë°©ë²•

### ì‚¬ì „ ìš”êµ¬ì‚¬í•­
- Java 17 ì´ìƒ
- Docker & Docker Compose
- Gradle 8.x
- MySQL 8.0 (Dockerë¡œ ì‹¤í–‰ ê°€ëŠ¥)

### ë¡œì»¬ ê°œë°œ í™˜ê²½ ì‹¤í–‰

#### 1. ì €ì¥ì†Œ í´ë¡ 
```bash
git clone https://github.com/Sungkyunkwan-2/payment-system-project.git
cd payment-system-project
```

#### 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
```bash
cp .env.example .env
# .env íŒŒì¼ì„ ì—´ì–´ í•„ìš”í•œ ê°’ ì„¤ì •
```

`.env` íŒŒì¼ ì˜ˆì‹œ:
```properties
# Database
SPRING_DATASOURCE_URL=jdbc:mysql://localhost:3306/paymentSystem?serverTimezone=Asia/Seoul&characterEncoding=UTF-8
SPRING_DATASOURCE_USERNAME=root
SPRING_DATASOURCE_PASSWORD=password

# PortOne (PG ê²°ì œ ê²Œì´íŠ¸ì›¨ì´)
PORTONE_API_SECRET=your_portone_api_secret
STORE_SECRET=store-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
WEBHOOK_SECRET=whsec_xxxxxxxxxxxxxxxxxxxxxxxxxxxx

# JWT
JWT_SECRET=your-very-long-jwt-secret-key-here
```

#### 3. Docker Compose ì‹¤í–‰ (MySQL)
```bash
docker-compose up -d mysql
```

#### 4. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
```bash
./gradlew bootRun --args='--spring.profiles.active=local'
```

#### 5. ì ‘ì† í™•ì¸
- API: http://localhost:8080
- Actuator: http://localhost:8080/actuator/health

### í”„ë¡œë•ì…˜ ë°°í¬

```bash
./gradlew build -x test
java -jar build/libs/payment-team-project-*.jar --spring.profiles.active=prod
```

<br/>

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
src
â””â”€â”€ main
   â”œâ”€â”€ java
   â”‚   â””â”€â”€ com
   â”‚       â””â”€â”€ paymentteamproject
   â”‚           â”œâ”€â”€ PaymentTeamProjectApplication.java
   â”‚           â”œâ”€â”€ common
   â”‚           â”‚   â”œâ”€â”€ controller          â† HomeController, PageController, ConfigController
   â”‚           â”‚   â”œâ”€â”€ dto                 â† ApiResponse, PublicConfigResponse
   â”‚           â”‚   â””â”€â”€ entity              â† BaseEntity (createdAt, updatedAt)
   â”‚           â”œâ”€â”€ config
   â”‚           â”‚   â”œâ”€â”€ SecurityConfig.java
   â”‚           â”‚   â”œâ”€â”€ RestClientConfig.java
   â”‚           â”‚   â”œâ”€â”€ PortOneProperties.java
   â”‚           â”‚   â”œâ”€â”€ AppProperties.java
   â”‚           â”‚   â”œâ”€â”€ ClientApiProperties.java
   â”‚           â”‚   â””â”€â”€ GlobalExceptionHandler.java
   â”‚           â”œâ”€â”€ security
   â”‚           â”‚   â”œâ”€â”€ JwtTokenProvider.java
   â”‚           â”‚   â”œâ”€â”€ JwtAuthenticationFilter.java
   â”‚           â”‚   â”œâ”€â”€ JwtAuthenticationEntryPoint.java
   â”‚           â”‚   â”œâ”€â”€ CustomUserDetails.java
   â”‚           â”‚   â””â”€â”€ CustomUserDetailsService.java
   â”‚           â””â”€â”€ domain
   â”‚               â”œâ”€â”€ auth                â† ì¸ì¦ (JWT, Refresh Token) 
   â”‚               â”œâ”€â”€ user                â† ì‚¬ìš©ì (í¬ì¸íŠ¸, ì´ ê±°ë˜ì•¡)
   â”‚               â”œâ”€â”€ product             â† ìƒí’ˆ (ì¬ê³  ê´€ë¦¬)
   â”‚               â”œâ”€â”€ order               â† ì£¼ë¬¸ (ì£¼ë¬¸ë²ˆí˜¸ ìë™ìƒì„±)
   â”‚               â”œâ”€â”€ orderProduct        â† ì£¼ë¬¸-ìƒí’ˆ ë§¤í•‘
   â”‚               â”œâ”€â”€ payment             â† ê²°ì œ (Append-Only, ì´ë²¤íŠ¸ ë°œí–‰)
   â”‚               â”œâ”€â”€ refund              â† í™˜ë¶ˆ (Append-Only)
   â”‚               â”œâ”€â”€ subscription        â† êµ¬ë… ì‹ ì²­/ì¡°íšŒ/í•´ì§€
   â”‚               â”œâ”€â”€ billing             â† ë¹Œë§í‚¤ ê²°ì œ/ì²­êµ¬ ë‚´ì—­
   â”‚               â”œâ”€â”€ plan                â† êµ¬ë… í”Œëœ
   â”‚               â”œâ”€â”€ paymentMethod       â† ê²°ì œ ìˆ˜ë‹¨
   â”‚               â”œâ”€â”€ pointTransaction    â† í¬ì¸íŠ¸ ì ë¦½/ì‚¬ìš©/ë§Œë£Œ
   â”‚               â”œâ”€â”€ membershipTransaction â† ë©¤ë²„ì‹­ ë“±ê¸‰ ì´ë ¥ + ìŠ¤ì¼€ì¤„ëŸ¬
   â”‚               â””â”€â”€ webhook             â† PortOne ì›¹í›… ìˆ˜ì‹  ë° ê²€ì¦
   â”‚
   â””â”€â”€ resources
       â”œâ”€â”€ application.yml
       â”œâ”€â”€ application-local.yml
       â”œâ”€â”€ application-prod.yml
       â”œâ”€â”€ client-api-config.yml
       â””â”€â”€ templates                       â† Thymeleaf í…œí”Œë¦¿

```

### íŒ¨í‚¤ì§€ êµ¬ì¡° ì„¤ëª…

- **domain**: ê° ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ë³„ë¡œ controller / service / repository / entity / dto / consts / exception êµ¬ì¡° ì ìš©

- **config**: Security, PortOne, JWT, RestClient, ì „ì—­ ì˜ˆì™¸ ì²˜ë¦¬ ë“± íš¡ë‹¨ ê´€ì‹¬ì‚¬ ì„¤ì •

- **security**: JWT ê¸°ë°˜ ì¸ì¦ í•„í„° ë° UserDetails ì»¤ìŠ¤í„°ë§ˆì´ì§•

<br/>

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 1. ì›¹í›… ì„œëª… ê²€ì¦ ì‹¤íŒ¨

**ë¬¸ì œ ìƒí™©**
```
PortOne ì›¹í›… ìš”ì²­ì´ Security Filter Chainì„ í†µê³¼í•˜ë©´ì„œ request bodyê°€ ì†Œë¹„ë˜ì–´
ì„œëª… ê²€ì¦ ì‹œ ë¹ˆ bodyê°€ ì „ë‹¬ë˜ëŠ” ë¬¸ì œ ë°œìƒ
```

**ì›ì¸ ë¶„ì„**

Springì˜ `HttpServletRequest`ëŠ” bodyë¥¼ í•œ ë²ˆë§Œ ì½ì„ ìˆ˜ ìˆì–´, Filterì—ì„œ bodyë¥¼ ë¨¼ì € ì½ìœ¼ë©´
Controllerì—ì„œ bodyë¥¼ ì½ì„ ìˆ˜ ì—†ê²Œ ë©ë‹ˆë‹¤.
ë˜í•œ JWT í•„í„°ê°€ ì›¹í›… ì—”ë“œí¬ì¸íŠ¸ì—ë„ ì ìš©ë˜ì–´ ë¶ˆí•„ìš”í•œ ì¸ì¦ ì‹œë„ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

**í•´ê²° ë°©ë²•**
```java
// SecurityConfig - ì›¹í›… ì—”ë“œí¬ì¸íŠ¸ JWT í•„í„° ì œì™¸
@Bean
public WebSecurityCustomizer webSecurityCustomizer() {
    return (web) -> web.ignoring().requestMatchers("/portone-webhook");
}

// WebhookEventController - raw bodyë¥¼ byte[]ë¡œ ì§ì ‘ ìˆ˜ì‹ 
@PostMapping("/portone-webhook")
public ResponseEntity<Void> handleWebhookEvent(
        @RequestBody byte[] rawBody,
        @RequestHeader("webhook-id") String webhookId,
        @RequestHeader("webhook-timestamp") String webhookTimestamp,
        @RequestHeader("webhook-signature") String webhookSignature) {
    ...
}
```

**ê²°ê³¼**

ì›¹í›… ì„œëª… ê²€ì¦ ì„±ê³µë¥  100% ë‹¬ì„±, ë¶ˆí•„ìš”í•œ JWT ì¸ì¦ ì˜¤ë²„í—¤ë“œ ì œê±°

---

### 2. í¬ì¸íŠ¸ ê²°ì œ ì‹œ ì¤‘ë³µ ê²°ì œ ë¬¸ì œ

**ë¬¸ì œ ìƒí™©**
```
ì „ì•¡ í¬ì¸íŠ¸ ê²°ì œ ì‹œ ê²°ì œ ì‹œì‘(start) ë‹¨ê³„ì—ì„œ SUCCESS ìƒíƒœë¡œ ì €ì¥ë˜ì—ˆìœ¼ë‚˜,
ì´í›„ í´ë¼ì´ì–¸íŠ¸ê°€ ê²°ì œ í™•ì¸(confirm)ì„ ì¬í˜¸ì¶œí•˜ëŠ” ê²½ìš° ì¤‘ë³µ ì²˜ë¦¬ ë°œìƒ
```

**ì›ì¸ ë¶„ì„**

ê²°ì œ í™•ì¸ APIì—ì„œ ì´ë¯¸ SUCCESS ìƒíƒœì¸ ê²°ì œë¥¼ ì¬ì²˜ë¦¬í•˜ë ¤ëŠ” ì‹œë„ë¥¼ ë°©ì–´í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

**í•´ê²° ë°©ë²•**
```java
// PaymentService.confirm()
if (payment.getStatus().equals(PaymentStatus.SUCCESS)) {
    throw new DuplicatePaymentConfirmException("ì´ë¯¸ ì²˜ë¦¬ ì¤‘ì´ê±°ë‚˜ ì™„ë£Œëœ ê²°ì œì…ë‹ˆë‹¤.");
}
```

**ê²°ê³¼**

ë©±ë“±ì„± ë³´ì¥ìœ¼ë¡œ ì¤‘ë³µ í¬ì¸íŠ¸ ì°¨ê° ë° ì¤‘ë³µ ê²°ì œ ë°©ì§€

---

### 3. DDL Auto ìš´ì˜ í™˜ê²½ ì„¤ì • ì´ìŠˆ

**ë¬¸ì œ ìƒí™©**
```
ìš´ì˜ í™˜ê²½ ë°°í¬ ì‹œ ddl-auto: create-drop ì„¤ì •ìœ¼ë¡œ ì¸í•´
ê¸°ì¡´ ë°ì´í„°ê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ ì¬ì‹œì‘ ì‹œ ì‚­ì œë˜ëŠ” ë¬¸ì œ
```

**í•´ê²° ë°©ë²•**
```yaml
# application-prod.yml
spring:
  jpa:
    hibernate:
      ddl-auto: validate  # ìš´ì˜ í™˜ê²½ì—ì„œëŠ” validate ì‚¬ìš©
```

**ê²°ê³¼**

ìš´ì˜ ë°ì´í„° ë³´í˜¸, ìŠ¤í‚¤ë§ˆ ë³€ê²½ì€ ë³„ë„ ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ë¡œ ê´€ë¦¬

<br/>

## âš¡ ì„±ëŠ¥ ìµœì í™”

### 1. ì§€ì—° ë¡œë”© ìµœì í™”

#### FetchType.LAZY ì ìš©
```java
// Payment Entity
@ManyToOne(fetch = FetchType.LAZY, optional = false)
@JoinColumn(name = "order_id", nullable = false)
private Orders order;
```

**ì ìš© ëŒ€ìƒ**
- Payment â†’ Orders ì—°ê´€ê´€ê³„
- Orders â†’ User ì—°ê´€ê´€ê³„
- Refund â†’ Payment ì—°ê´€ê´€ê³„

**íš¨ê³¼**

ë¶ˆí•„ìš”í•œ ì¡°ì¸ ì¿¼ë¦¬ ì œê±°ë¡œ ì¡°íšŒ ì„±ëŠ¥ ê°œì„ 

---

### 2. ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”

#### ì¸ë±ìŠ¤ ìµœì í™”
```sql
-- ê²°ì œ ID ì¡°íšŒ ìµœì í™” (Append-Only íŒ¨í„´ìœ¼ë¡œ ìµœì‹  ë ˆì½”ë“œ ì¡°íšŒ)
-- PaymentRepository
Payment findFirstByPaymentIdOrderByIdDesc(String paymentId);
```

**ê²°ê³¼**

ê²°ì œ í™•ì¸ API ì‘ë‹µ ì†ë„ ê°œì„ 

#### ì»¤ë„¥ì…˜ í’€ ìµœì í™”
```yaml
spring:
  datasource:
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000
```

---

<br/>

## ğŸ“ˆ í–¥í›„ ê°œì„  ê³„íš

### Service ì±…ì„ ë¶„ì‚°ì„ ìœ„í•œ ì´ë²¤íŠ¸ ê¸°ë°˜ êµ¬ì¡° ë„ì…
### Refresh Token í•´ì‹œ ì €ì¥
### ì™¸ë¶€API í˜¸ì¶œ íŠ¸ëœì­ì…˜ ë¶„ë¦¬
### ì›¹í›… & ì™¸ë¶€ API ì²˜ë¦¬ ë©±ë“±ì„± ë³´ì¥ ê°•í™”
### ë™ì‹œì„± ì²´í¬ ê°•í™”

<br/>

## ğŸ’¡ ë°°ìš´ ì 

### ê¸°ìˆ ì  ì„±ì¥

#### 1. PortOne V2 API ì—°ë™ ê²½í—˜

ê²°ì œ ì‹œì‘ â†’ PG ê²°ì œì°½ í˜¸ì¶œ â†’ ê²°ì œ í™•ì¸ â†’ ì›¹í›… ìˆ˜ì‹ ê¹Œì§€ ì „ì²´ ê²°ì œ í”Œë¡œìš°ë¥¼ ì§ì ‘ êµ¬í˜„í•˜ë©´ì„œ,
ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œ PG ì—°ë™ì´ ì–¼ë§ˆë‚˜ ë³µì¡í•œì§€ ì´í•´í–ˆìŠµë‹ˆë‹¤.
íŠ¹íˆ ì›¹í›… ì„œëª… ê²€ì¦ê³¼ ë©±ë“±ì„± ì²˜ë¦¬ì˜ ì¤‘ìš”ì„±ì„ ì‹¤ê°í–ˆìŠµë‹ˆë‹¤.

#### 2. Append-Only íŒ¨í„´ì˜ ì¤‘ìš”ì„±

ê²°ì œì™€ í™˜ë¶ˆ ì´ë ¥ì„ UPDATEê°€ ì•„ë‹Œ ìƒˆ row INSERTë¡œ ê´€ë¦¬í•¨ìœ¼ë¡œì¨
ë°ì´í„° ë¬´ê²°ì„±ì„ ë³´ì¥í•˜ê³  ê°ì‚¬ ì¶”ì ì´ ìš©ì´í•´ì¡ŒìŠµë‹ˆë‹¤.
ì´ íŒ¨í„´ì´ ê¸ˆìœµ ë„ë©”ì¸ì—ì„œ ì™œ í•„ìˆ˜ì ì¸ì§€ ì´í•´í–ˆìŠµë‹ˆë‹¤.

#### 3. ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜

`ApplicationEventPublisher`ë¥¼ í™œìš©í•˜ì—¬ ê²°ì œ ì™„ë£Œ ì´ë²¤íŠ¸ì™€ ë©¤ë²„ì‹­ ê°±ì‹ ì„ ë¶„ë¦¬í•¨ìœ¼ë¡œì¨
ë„ë©”ì¸ ê°„ ê²°í•©ë„ë¥¼ ë‚®ì¶”ê³  ì½”ë“œì˜ ë‹¨ì¼ ì±…ì„ ì›ì¹™ì„ ì§€í‚¬ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

#### 4. JWT ì¸ì¦ ì‹¬í™” ì´í•´

Access Token + Refresh Token ì´ì¤‘ êµ¬ì¡°, HttpOnly ì¿ í‚¤ë¥¼ í†µí•œ Refresh Token ê´€ë¦¬,
CORS í™˜ê²½ì—ì„œì˜ Authorization í—¤ë” ë…¸ì¶œ ì„¤ì • ë“± ì‹¤ë¬´ ìˆ˜ì¤€ì˜ ì¸ì¦ êµ¬í˜„ì„ ê²½í—˜í–ˆìŠµë‹ˆë‹¤.

### ê°œë°œ í”„ë¡œì„¸ìŠ¤

#### 1. ë„ë©”ì¸ ì£¼ë„ ì„¤ê³„ (DDD) ì‹œë„

ê° ë„ë©”ì¸(payment, order, refund ë“±)ì„ ë…ë¦½ì ì¸ íŒ¨í‚¤ì§€ë¡œ ë¶„ë¦¬í•˜ê³ ,
ë„ë©”ì¸ ë¡œì§ì„ ì„œë¹„ìŠ¤ê°€ ì•„ë‹Œ ì—”í‹°í‹°ì— ìµœëŒ€í•œ ì‘ì§‘ì‹œí‚¤ëŠ” ì„¤ê³„ë¥¼ ì—°ìŠµí–ˆìŠµë‹ˆë‹¤.

#### 2. ì˜ˆì™¸ ì²˜ë¦¬ ì „ëµ

`GlobalExceptionHandler`ì™€ ì»¤ìŠ¤í…€ ì˜ˆì™¸ í´ë˜ìŠ¤ë¥¼ í†µí•´ ì¼ê´€ëœ ì—ëŸ¬ ì‘ë‹µ í˜•ì‹ì„ ìœ ì§€í–ˆìŠµë‹ˆë‹¤.
ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸(`BusinessException`)ì™€ ì‹œìŠ¤í…œ ì˜ˆì™¸ë¥¼ ëª…í™•íˆ êµ¬ë¶„í•˜ëŠ” ë°©ë²•ì„ ë°°ì› ìŠµë‹ˆë‹¤.

#### 3. í™˜ê²½ ë¶„ë¦¬ì˜ ì¤‘ìš”ì„±

`application-local.yml`, `application-prod.yml`ë¡œ í™˜ê²½ì„ ë¶„ë¦¬í•˜ê³ ,
AWS Parameter Storeë¥¼ í†µí•œ ë¯¼ê° ì •ë³´ ê´€ë¦¬ë¡œ ë³´ì•ˆì„ ê°•í™”í–ˆìŠµë‹ˆë‹¤.

### ì•„ì‰¬ìš´ ì  ë° ê°œì„  ë°©í–¥

#### 1. í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ë¶€ì¡±

í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§(PaymentService, RefundService)ì— ëŒ€í•œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ì¶©ë¶„íˆ ì‘ì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.
í–¥í›„ TDD ë°©ì‹ìœ¼ë¡œ ê²°ì œ í”Œë¡œìš° ì „ì²´ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•  ì˜ˆì •ì…ë‹ˆë‹¤.

#### 2. Redis ë¯¸ë„ì…

í˜„ì¬ Refresh Tokenì„ RDBì— ì €ì¥í•˜ê³  ìˆì–´ ì„±ëŠ¥ ë³‘ëª©ì´ ìš°ë ¤ë©ë‹ˆë‹¤.
Redisë¥¼ ë„ì…í•˜ì—¬ Refresh Token ê´€ë¦¬ ë° ìƒí’ˆ ëª©ë¡ ìºì‹±ì— í™œìš©í•  ê³„íšì…ë‹ˆë‹¤.

#### 3. API ë¬¸ì„œ ìë™í™” ë¯¸ë¹„

í˜„ì¬ Swagger UI ì„¤ì •ì€ ìˆìœ¼ë‚˜ ì–´ë…¸í…Œì´ì…˜ ê¸°ë°˜ ë¬¸ì„œí™”ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.
SpringDoc OpenAPI 3.0ìœ¼ë¡œ ì „í™˜í•˜ì—¬ API ë¬¸ì„œë¥¼ ìë™í™”í•  ì˜ˆì •ì…ë‹ˆë‹¤.

<br/>

## ğŸ‘¨â€ğŸ’» ê°œë°œì

**íŒ€ëª…**: ì„±ê· ê´€ <br>
**ì†Œì†**: ë‚´ì¼ë°°ì›€ìº í”„ ì‹¤ì‹œê°„ ì»¤ë¨¸ìŠ¤ í”Œë«í¼ ê°œë°œì ì–‘ì„± ê³¼ì • 2ê¸° <br>
**GitHub**: [https://github.com/Sungkyunkwan-2/payment-system-project](https://github.com/Sungkyunkwan-2/payment-system-project)

**ì´ë¦„**: ê³½í˜„ë¯¼ <br>
**ì§ì±…**: íŒ€ì¥ <br>
**ë‹´ë‹¹ íŒŒíŠ¸**: ê²°ì œ, êµ¬ë… <br>
**Github**: https://github.com/prAha1030 <br>
**Email**: hunmin111@gmail.com <br>

**ì´ë¦„**: ê¹€ì„¸í˜„ <br>
**ì§ì±…**: íŒ€ì› <br>
**ë‹´ë‹¹ íŒŒíŠ¸**: jwt ê¸°ë°˜ stateless ì¸ì¦, refresh token, erd ì‘ì„±, ì´ë²¤íŠ¸ë¦¬ìŠ¤ë„ˆ êµ¬í˜„<br>
**Github**: https://github.com/ginsengcandy <br>
**Email**: kimsparadise0202@gmail.com <br>

**ì´ë¦„**: ê¹€ëŒ€í›ˆ <br>
**ì§ì±…**: íŒ€ì› <br>
**ë‹´ë‹¹ íŒŒíŠ¸**: ì£¼ë¬¸ ìƒì„±, ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ, í¬ì¸íŠ¸ ê´€ë ¨ ë¡œì§ê³¼ ì—°ê³„ëœ ë©”ì„œë“œ ì‘ì„±, ë°œí‘œ<br>
**Github**: https://github.com/BigMacHun-del<br>
**Email**: eogns12312@naver.com<br>

**ì´ë¦„**: ì´í˜„ì„ <br>
**ì§ì±…**: íŒ€ì› <br>
**ë‹´ë‹¹ íŒŒíŠ¸**: í™˜ë¶ˆ, ë©¤ë²„ì‹­, ë°œí‘œ ìë£Œ ì¤€ë¹„<br>
**Github**: https://github.com/royhslee0120<br>
**Email**: royhslee0120@gmail.com<br>

**ì´ë¦„**: ìœ ì§€í˜„ <br>
**ì§ì±…**: íŒ€ì› <br>
**ë‹´ë‹¹ íŒŒíŠ¸**: webhook, subscription <br> 
**Github**: https://github.com/jihyeon1346 <br> 
**Email**: yio1346@gmail.com <br> 


<br/>

## ğŸ“„ ë¼ì´ì„ ìŠ¤

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

<br/>

## ğŸ™ ê°ì‚¬ì˜ ë§

PortOne V2 API ë¬¸ì„œ ë° ê³µì‹ ì˜ˆì œ ì½”ë“œë¥¼ ì°¸ê³ í•˜ì˜€ìŠµë‹ˆë‹¤.

---

â­ ì´ í”„ë¡œì íŠ¸ê°€ ë„ì›€ì´ ë˜ì…¨ë‹¤ë©´ Starë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”!
